{% extends "tasks/base.html" %}
{% load static %}
{% block layout_mode %}wide{% endblock %}

{% block breadcrumbs %}
<div class="tps-view-head">
  <p class="tps-view-kicker">Lecturer Workspace</p>
  <h1 class="tps-view-title">{{ team }}</h1>
  <p class="tps-view-subtitle">Detailed team performance and task list</p>
</div>
{% endblock %}

{% block small_left_content %}
<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Team Info</h2>
    <a href="{% url 'lecturer_view_course' course.id %}" class="btn btn-sm btn-outline-secondary">Back</a>
  </div>
  <div class="tps-section-body">
    <p class="mb-0">
      <a href="{{ team.github }}" target="_blank" rel="noopener noreferrer">
        <i class="bi bi-github"></i> Visit Team Git Repository
      </a>
    </p>
  </div>
</section>

<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Team Points</h2>
  </div>
  <div class="tps-section-body">
    <ul class="tps-list-clean">
      {% for key, value in team.get_milestone_list.items %}
      <li class="d-flex justify-content-between align-items-center">
        <span>{{ key }}</span>
        <span class="badge bg-secondary">{{ value }}</span>
      </li>
      {% empty %}
      <li class="text-muted">No milestone data.</li>
      {% endfor %}
    </ul>
  </div>
</section>

<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Developer Points</h2>
    <a href="{% url 'lecturer_team_points_detail' team.pk %}" class="btn btn-sm btn-outline-primary">
      <i class="bi bi-bar-chart-line"></i> View Breakdown
    </a>
  </div>
  <div class="tps-section-body">
    <div class="tps-stack">
      {% for dev, value in developers.items %}
      <div class="tps-note-item">
        <span class="tps-note-label">{{ dev }}</span>
        <p class="tps-note-value mb-1">Overall Project: {{ value.0 }} points</p>
        <div class="small text-muted">
          {% for k, v in value.1.items %}
          <div>{{ k }}: {{ v }} points</div>
          {% endfor %}
        </div>
      </div>
      {% empty %}
      <div class="text-muted small">No developer data.</div>
      {% endfor %}
    </div>
  </div>
</section>
{% endblock %}

{% block large_main_content %}
<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Team Tasks</h2>
    <span class="text-muted small">{{ tasks|length }} items</span>
  </div>
  <div class="p-0">
    <div class="table-responsive table-responsive-md-stack">
      <table class="table tps-table-clean table-hover align-middle">
        <thead>
          <tr>
            <th scope="col">Team</th>
            <th scope="col">Owner</th>
            <th scope="col">Title</th>
            <th scope="col">Milestone</th>
            <th scope="col">Status</th>
            <th scope="col">Completion</th>
          </tr>
        </thead>
        <tbody>
          {% for task in tasks %}
          <tr>
            <td>{{ task.team }}</td>
            <td>{{ task.owner }}</td>
            <td><a href="{% url 'lecturer_view_task' task.pk %}">{{ task }}</a></td>
            <td>{{ task.milestone }}</td>
            <td>
              <span class="badge {% if task.status == 1 %}bg-warning text-dark{% elif task.status == 2 %}bg-primary{% elif task.status == 3 %}bg-info text-dark{% elif task.status == 4 %}bg-danger{% else %}bg-success{% endif %}">
                {{ task.getStatus }}
              </span>
            </td>
            <td>{% if task.completed %}{{ task.completed|timeuntil:task.opened }}{% else %}-{% endif %}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted py-4">No tasks available.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}
