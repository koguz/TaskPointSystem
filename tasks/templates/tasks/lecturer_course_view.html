{% extends "tasks/base.html" %}
{% load static %}
{% block layout_mode %}wide{% endblock %}

{% block breadcrumbs %}
<div class="tps-view-head">
  <p class="tps-view-kicker">Lecturer Workspace</p>
  <h1 class="tps-view-title">{{ course }}</h1>
  <p class="tps-view-subtitle">Milestones, teams, and all task activity for this course</p>
</div>
{% endblock %}

{% block small_left_content %}
<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Actions</h2>
  </div>
  <div class="tps-section-body">
    <div class="d-grid gap-2">
      <a href="{% url 'lecturer_view' %}" class="btn btn-sm btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Lecturer View
      </a>
      <a href="{% url 'lecturer_course_points' course.id %}" class="btn btn-sm btn-outline-primary">
        <i class="bi bi-table"></i> Course Points
      </a>
    </div>
  </div>
</section>

<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Milestones</h2>
    <a href="{% url 'create_milestone' course.id %}" class="btn btn-sm btn-outline-primary">Create</a>
  </div>
  <div class="tps-section-body">
    <ul class="tps-list-clean">
      {% for ms in milestones %}
      <li>
        <div class="fw-bold">{{ ms }}</div>
        <div class="small mt-1">
          <a href="{% url 'edit_milestone' ms.id %}">Edit</a>
          <span class="mx-1">|</span>
          <a href="{% url 'grade_milestone' ms.id %}">Grades</a>
        </div>
      </li>
      {% empty %}
      <li class="text-muted">No milestones.</li>
      {% endfor %}
    </ul>
  </div>
</section>

<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Teams</h2>
    <a href="{% url 'create_team' course.id %}" class="btn btn-sm btn-outline-primary">Create Teams</a>
  </div>
  <div class="tps-section-body">
    <ul class="tps-list-clean">
      {% for team in teams %}
      <li><a href="{% url 'lecturer_view_team' team.id %}">{{ team }}</a></li>
      {% empty %}
      <li class="text-muted">No teams.</li>
      {% endfor %}
    </ul>
  </div>
</section>

<section class="tps-section mb-0">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Course Status</h2>
  </div>
  <div class="tps-section-body">
    {% if course.active %}
    <form method="post" action="{% url 'end_course' course.id %}" onsubmit="return confirm('End this course and disable all student changes?');">
      {% csrf_token %}
      <button type="submit" class="btn btn-sm btn-outline-danger w-100">
        <i class="bi bi-stop-circle"></i> End Course
      </button>
    </form>
    <p class="small text-muted mt-2 mb-0">This deactivates the course and makes student task actions read-only.</p>
    {% else %}
    <span class="badge bg-secondary">Completed</span>
    <p class="small text-muted mt-2 mb-0">This course is inactive. Student task actions are read-only.</p>
    {% endif %}
  </div>
</section>
{% endblock %}

{% block large_main_content %}
<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Course Tasks</h2>
    <span class="text-muted small">{{ tasks|length }} items</span>
  </div>
  <div class="p-0">
    <div class="table-responsive table-responsive-md-stack">
      <table class="table tps-table-clean table-hover align-middle">
        <thead>
          <tr>
            <th scope="col">Team</th>
            <th scope="col">Owner</th>
            <th scope="col">Title</th>
            <th scope="col">Milestone</th>
            <th scope="col">Status</th>
            <th scope="col">Completion</th>
          </tr>
        </thead>
        <tbody>
          {% for task in tasks %}
          <tr>
            <td>{{ task.team }}</td>
            <td>{{ task.owner }}</td>
            <td><a href="{% url 'lecturer_view_task' task.pk %}">{{ task }}</a></td>
            <td>{{ task.milestone }}</td>
            <td>
              <span class="badge {% if task.status == 1 %}bg-warning text-dark{% elif task.status == 2 %}bg-primary{% elif task.status == 3 %}bg-info text-dark{% elif task.status == 4 %}bg-danger{% else %}bg-success{% endif %}">
                {{ task.getStatus }}
              </span>
            </td>
            <td>{% if task.completed %}{{ task.completed|timeuntil:task.opened }}{% else %}-{% endif %}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted py-4">No tasks available.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}
