{% extends "tasks/base.html" %}
{% load static %}
{% block layout_mode %}three{% endblock %}

{% block breadcrumbs %}
<div class="tps-view-head">
  <p class="tps-view-kicker">Lecturer Workspace</p>
  <h1 class="tps-view-title">Create Teams</h1>
  <p class="tps-view-subtitle">{{ course }}</p>
</div>
{% endblock %}

{% block left_content %}
<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Manual Format</h2>
  </div>
  <div class="tps-section-body small">
    <p>Use one student per line in this format:</p>
    <p><code>Team Name, Student ID, Student Name, Student Surname</code></p>
    <p>Optional columns at the end:</p>
    <p><code>..., Section, Description</code></p>
    <p class="mb-0">If a team name already exists in this course, that team is reused.</p>
  </div>
</section>

<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Current Assignments</h2>
  </div>
  <div class="tps-section-body">
    <div class="table-responsive">
      <table class="table tps-table-clean table-sm mb-0">
        <tbody>
          {% for key, value in t_d.items %}
            {% for row in value %}
            <tr>
              <td>{{ row.developer.user.username }}</td>
              <td>{{ row.developer.getName }}</td>
              <td>Section {{ row.section|default:"-" }}</td>
              <td>{{ row.description|default:"" }}</td>
              <td class="text-muted">{{ key }}</td>
            </tr>
            {% endfor %}
          {% empty %}
          <tr>
            <td class="text-muted">No assignments yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}

{% block main_content %}
{% if success_message %}
<div class="alert alert-success" role="alert">
  {{ success_message }}
</div>
{% endif %}
{% if errors %}
<div class="alert alert-danger" role="alert">
  <ul class="mb-0 ps-3">
    {% for err in errors %}
    <li>{{ err }}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Manual Team Creation</h2>
  </div>
  <div class="tps-section-body">
    <form action="{% url 'create_team' course.pk %}" method="post" class="tps-form-grid">
      {% csrf_token %}
      <div>
        <label for="default-section-manual" class="form-label">Default Section</label>
        <input id="default-section-manual" type="number" min="1" name="default_section" value="1" class="form-control" />
      </div>
      <div>
        <label for="default-section-description-manual" class="form-label">Default Description (Optional)</label>
        <input id="default-section-description-manual" type="text" name="default_section_description" class="form-control" placeholder="e.g. Monday mornings" />
      </div>
      <div>
        <label for="manual-list" class="form-label">Team + Student List</label>
        <textarea id="manual-list" rows="16" name="manual_list" class="form-control" placeholder="Example:&#10;Alpha Team, 20191234, Ayse, Yilmaz, 1, Monday mornings&#10;Alpha Team, 20195678, Ali, Kaya&#10;Beta Team, 20193456, Elif, Demir, 2, Wednesday afternoons"></textarea>
      </div>
      <input type="hidden" name="mode" value="manual" />
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Create Teams Manually</button>
      </div>
    </form>
  </div>
</section>
{% endblock %}

{% block right_content %}
<section class="tps-section">
  <div class="tps-section-header">
    <h2 class="tps-section-title">Random Team Generation</h2>
  </div>
  <div class="tps-section-body">
    <form action="{% url 'create_team' course.pk %}" method="post" class="tps-form-grid">
      {% csrf_token %}
      <div>
        <label for="default-section-random" class="form-label">Default Section</label>
        <input id="default-section-random" type="number" min="1" name="default_section" value="1" class="form-control" />
      </div>
      <div>
        <label for="default-section-description-random" class="form-label">Default Description (Optional)</label>
        <input id="default-section-description-random" type="text" name="default_section_description" class="form-control" placeholder="e.g. Monday mornings" />
      </div>
      <div>
        <label for="team-size" class="form-label">Students Per Team</label>
        <input id="team-size" type="number" min="1" name="team_size" value="4" class="form-control" />
      </div>
      <div>
        <label for="random-list" class="form-label">Student List</label>
        <textarea id="random-list" rows="16" name="random_list" class="form-control" placeholder="Format (one per line):&#10;Student ID, Student Name, Student Surname&#10;Optional: Student ID, Student Name, Student Surname, Section, Description&#10;&#10;Example:&#10;20191234, Ayse, Yilmaz, 1, Monday mornings&#10;20195678, Ali, Kaya"></textarea>
      </div>
      <input type="hidden" name="mode" value="random" />
      <div class="form-actions">
        <button type="submit" class="btn btn-outline-primary">Generate Random Teams</button>
      </div>
    </form>
  </div>
</section>
{% endblock %}
