{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css"
    />
    <link rel="stylesheet" href="{% static 'tasks/style.css' %}" />
    {% block customcss %}{% endblock %}
    <title>TPS - {{ page_title|default:"Dashboard" }}</title>
  </head>
  <body>
    <header class="tps-shell sticky-top">
      <nav class="navbar navbar-expand-lg tps-navbar">
        <div class="container py-2">
          <a class="navbar-brand tps-brand" href="{% url 'index' %}">
            <span class="tps-brand-mark"><i class="bi bi-kanban"></i></span>
            <span class="tps-brand-title">Task Point System</span>
          </a>
          {% if user.is_authenticated %}
          <button
            class="navbar-toggler tps-navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          {% endif %}

          {% block menubar %}
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
              {% if user.is_authenticated %}
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle tps-user-toggle"
                  href="#"
                  id="userNavDropdown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <img
                    src="{{ navbar_avatar_url }}"
                    alt="{{ user.get_full_name|default:user.username }}"
                    class="tps-nav-avatar"
                  />
                  <span>{{ user.get_full_name|default:user.username }}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end tps-user-menu" aria-labelledby="userNavDropdown">
                  <li>
                    <a class="dropdown-item" href="{% url 'my_details' %}">
                      <i class="bi bi-person-circle"></i> Profile
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="{% url 'change_password' %}">
                      <i class="bi bi-key"></i> Password
                    </a>
                  </li>
                  {% if not perms.tasks.add_team %}
                  <li>
                    <a class="dropdown-item" href="{% url 'email' %}">
                      <i class="bi bi-envelope"></i> Email
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="#" id="push-bell-btn" onclick="if(window.tpsEnablePush)window.tpsEnablePush();return false;">
                      <i class="bi bi-bell"></i> Enable Notifications
                    </a>
                  </li>
                  {% endif %}
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <form method="post" action="{% url 'logout' %}" style="margin:0">
                      {% csrf_token %}
                      <button type="submit" class="dropdown-item">
                        <i class="bi bi-box-arrow-right"></i> Logout
                      </button>
                    </form>
                  </li>
                </ul>
              </li>
              {% endif %}
            </ul>
          </div>
          {% endblock %}
        </div>
      </nav>
    </header>

    <main class="container py-4 tps-layout-shell layout-{% block layout_mode %}single{% endblock %}">
      <div class="row tps-breadcrumb-row">
        <div class="col-12">
          {% block breadcrumbs %}{% endblock %}
        </div>
      </div>

      {% block alert %}{% endblock %}

      <div class="row tps-layout-row tps-layout-row-main">
        <aside class="col-12 col-xl-3 tps-col-left">{% block left_content %}{% endblock %}</aside>
        <section class="col-12 col-xl-6 tps-col-main">{% block main_content %}{% endblock %}</section>
        <aside class="col-12 col-xl-3 tps-col-right">{% block right_content %}{% endblock %}</aside>
      </div>

      <div class="row tps-layout-row tps-layout-row-split">
        <section class="col-12 col-xl-6">{% block main_left_content %}{% endblock %}</section>
        <section class="col-12 col-xl-6">{% block main_right_content %}{% endblock %}</section>
      </div>

      <div class="row tps-layout-row tps-layout-row-wide">
        <aside class="col-12 col-xl-3">{% block small_left_content %}{% endblock %}</aside>
        <section class="col-12 col-xl-9">{% block large_main_content %}{% endblock %}</section>
      </div>
    </main>

    <footer class="tps-footer mt-5">
      <div class="container py-3">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2">
          <div class="tps-footer-left">
            <span class="tps-footer-title">Task Point System</span>
            <span class="tps-footer-muted">2017-2026</span>
          </div>
          <div class="tps-footer-links">
            {% if user.is_authenticated %}
              {% if perms.tasks.add_team %}
              <a href="{% url 'lecturer_view' %}">Dashboard</a>
              {% else %}
              <a href="{% url 'index' %}">Dashboard</a>
              <a href="{% url 'my_details' %}">Profile</a>
              {% endif %}
              <a href="{% url 'view_updates' %}">About</a>
              <form method="post" action="{% url 'logout' %}" style="display:inline">
                {% csrf_token %}
                <button type="submit" style="background:none;border:none;color:inherit;cursor:pointer;padding:0;font:inherit">Logout</button>
              </form>
            {% else %}
              <a href="{% url 'login' %}">Login</a>
            {% endif %}
          </div>
        </div>
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"
      integrity="sha256-xH4q8N0pEzrZMaRmd7gQVcTZiFei+HfRTBPJ1OGXC0k="
      crossorigin="anonymous"
    ></script>

    {% if user.is_authenticated %}
    <script src="{% static 'tasks/push.js' %}"></script>
    {% endif %}
    {% block scriptblock %}
    <script>
      $(function () {
        $(".datepicker").datepicker({ dateFormat: "yy-mm-dd" });
        $('[data-bs-toggle="tooltip"], [data-toggle="tooltip"]').tooltip();

        $(
          'input:not([type="checkbox"]):not([type="radio"]):not([type="submit"]):not([type="button"]):not([type="hidden"]):not([type="file"])'
        ).addClass("form-control");
        $("textarea").addClass("form-control");
        $("select").addClass("form-select");
      });
    </script>
    {% endblock %}
  </body>
</html>
